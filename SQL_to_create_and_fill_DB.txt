CREATE TABLE user_address
(
    address_id  BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    country     VARCHAR(40),
    city        VARCHAR(40),
    street      VARCHAR(50),
    postal_code INTEGER,
    CONSTRAINT pk_user_address PRIMARY KEY (address_id)
);

CREATE TABLE app_user
(
    user_id      BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    first_name   VARCHAR(30)                             NOT NULL,
    last_name    VARCHAR(30)                             NOT NULL,
    email        VARCHAR(30)                            NOT NULL,
    password     VARCHAR(100),
    phone_number VARCHAR(20),
    address_id   BIGINT,
    role         VARCHAR(40),
    CONSTRAINT pk_app_user PRIMARY KEY (user_id)
);

ALTER TABLE app_user
    ADD CONSTRAINT uc_app_user_email UNIQUE (email);

ALTER TABLE app_user
    ADD CONSTRAINT FK_APP_USER_ON_ADDRESS FOREIGN KEY (address_id) REFERENCES user_address (address_id);

CREATE TABLE car
(
    car_id              BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    make                BIGINT,
    model               VARCHAR(30),
    year                INTEGER,
    color               VARCHAR(30),
    transmission        VARCHAR(20),
    fuel                VARCHAR(20),
    mileage             INTEGER,
    engine_displacement DOUBLE PRECISION,
    car_type            VARCHAR(20),
    is_new              BOOLEAN,
    description         VARCHAR(255),
    price               DOUBLE PRECISION,
    car_status          VARCHAR(30),
    CONSTRAINT pk_car PRIMARY KEY (car_id)
);

CREATE TABLE car_make
(
    make_id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    name    VARCHAR(255),
    CONSTRAINT pk_car_make PRIMARY KEY (make_id)
);

CREATE TABLE car_user
(
    car_id  BIGINT NOT NULL,
    user_id BIGINT NOT NULL
);

ALTER TABLE car
    ADD CONSTRAINT FK_CAR_ON_MAKE FOREIGN KEY (make) REFERENCES car_make (make_id);

ALTER TABLE car_user
    ADD CONSTRAINT fk_car_user_on_car FOREIGN KEY (car_id) REFERENCES car (car_id);

ALTER TABLE car_user
    ADD CONSTRAINT fk_car_user_on_user FOREIGN KEY (user_id) REFERENCES app_user (user_id);



CREATE TABLE car_request
(
    request_id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    user_id    BIGINT,
    car_car_id BIGINT,
    created_at date,
    status     VARCHAR(30),
    CONSTRAINT pk_car_request PRIMARY KEY (request_id)
);

ALTER TABLE car_request
    ADD CONSTRAINT FK_CAR_REQUEST_ON_CAR_CAR FOREIGN KEY (car_car_id) REFERENCES car (car_id);

ALTER TABLE car_request
    ADD CONSTRAINT FK_CAR_REQUEST_ON_USER FOREIGN KEY (user_id) REFERENCES app_user (user_id);

CREATE TABLE user_order
(
    order_id     BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    user_id      BIGINT,
    car_id       BIGINT,
    order_date   date,
    order_status VARCHAR(30),
    CONSTRAINT pk_user_order PRIMARY KEY (order_id)
);

ALTER TABLE user_order
    ADD CONSTRAINT FK_USER_ORDER_ON_CAR FOREIGN KEY (car_id) REFERENCES car (car_id);

ALTER TABLE user_order
    ADD CONSTRAINT FK_USER_ORDER_ON_USER FOREIGN KEY (user_id) REFERENCES app_user (user_id);

------
INSERT INTO car_make (name) VALUES ('Volkswagen');
INSERT INTO car_make (name) VALUES ('Honda');
INSERT INTO car_make (name) VALUES ('Hyundai');
INSERT INTO car_make (name) VALUES ('Kia');
INSERT INTO car_make (name) VALUES ('Audi');
INSERT INTO car_make (name) VALUES ('BMW');
INSERT INTO car_make (name) VALUES ('Chevrolet');
INSERT INTO car_make (name) VALUES ('Ford');
INSERT INTO car_make (name) VALUES ('Lexus');
INSERT INTO car_make (name) VALUES ('Mazda');
INSERT INTO car_make (name) VALUES ('Mercedes-Benz');
INSERT INTO car_make (name) VALUES ('Mitsubishi');
INSERT INTO car_make (name) VALUES ('Nissan');
INSERT INTO car_make (name) VALUES ('Opel');
INSERT INTO car_make (name) VALUES ('Renault');
INSERT INTO car_make (name) VALUES ('Skoda');
INSERT INTO car_make (name) VALUES ('Toyota');
INSERT INTO car_make (name) VALUES ('Volkswagen');
INSERT INTO car_make (name) VALUES ('Volvo');
INSERT INTO car_make (name) VALUES ('Peugeout');

----
INSERT INTO car ( model, year, color, transmission, engine_displacement, fuel, car_type, mileage, is_new, description, make, price, car_status)
VALUES ('Passat', 2016, 'grey', 'AUTOMATIC', 2.5, 'PETROL', 'SEDAN', 45000, false, 'After accident in USA, minor damage, run and drive', 1, 18500, 'IN_STOCK');

INSERT INTO car ( model, year, color, transmission, engine_displacement, fuel, car_type, mileage, is_new, description, make, price, car_status)
VALUES ( 'Civic', 2012, 'black', 'AUTOMATIC', 1.8, 'PETROL', 'SEDAN', 120000, false, 'After accident in USA, needs repair', 2, 9000, 'IN_STOCK');

INSERT INTO car ( model, year, color, transmission, engine_displacement, fuel, car_type, mileage, is_new, description, make, price, car_status)
VALUES ('Accord', 2014, 'black', 'AUTOMATIC', 2.0, 'HYBRID', 'SEDAN', 60000, false, 'Nearly new condition', 2, 13800, 'IN_STOCK');

INSERT INTO car ( model, year, color, transmission, engine_displacement, fuel, car_type, mileage, is_new, description, make, price, car_status)
VALUES ('Golf', 2016, 'white', 'AUTOMATIC', 2.0, 'PETROL', 'HATCHBACK', 8000, false, 'GTI model, like new', 1, 20000, 'IN_STOCK');

INSERT INTO car ( model, year, color, transmission, engine_displacement, fuel, car_type, mileage, is_new, description, make, price, car_status)
VALUES ('Sonata', 2012, 'orange', 'MANUAL', 2.0, 'HYBRID', 'SEDAN', 420000, false, 'Was used in taxi, needs interior repair', 3, 8300, 'IN_STOCK');

INSERT INTO car ( model, year, color, transmission, engine_displacement, fuel, car_type, mileage, is_new, description, make, price, car_status)
VALUES ('Ceed', 2022, 'bronze', 'MANUAL', 1.6, 'PETROL', 'WAGON', 15, true, 'Luxury model', 4, 23000, 'IN_STOCK');

INSERT INTO car ( model, year, color, transmission, engine_displacement, fuel, car_type, mileage, is_new, description, make, price, car_status)
VALUES ('Santa Fe', 2020, 'white', 'AUTOMATIC', 2.0, 'PETROL', 'SUV', 13000, false, 'After flood in Korea, needs electrical issues to be fixed', 4, 12000, 'IN_STOCK');

INSERT INTO car (model, year, color, transmission, engine_displacement, fuel, car_type, mileage, is_new, description, make, price, car_status)
VALUES ('Laguna', 2008, 'black', 'AUTOMATIC', 2.0, 'DIESEL', 'WAGON', 270000, false, 'Good condition', 15, 7500, 'IN_STOCK');

INSERT INTO car (model, year, color, transmission, engine_displacement, fuel, car_type, mileage, is_new, description, make, price, car_status)
VALUES ('Sonata', 2015, 'white', 'AUTOMATIC', 2.4, 'PETROL', 'SEDAN', 40000, false, 'Like new condition, bought new from dealership', 3, 14500, 'IN_STOCK');

INSERT INTO car (model, year, color, transmission, engine_displacement, fuel, car_type, mileage, is_new, description, make, price, car_status)
VALUES ('Rogue', 2020, 'grey', 'AUTOMATIC', 2.5, 'PETROL', 'SUV', 7000, false, 'Good condition', 13, 18000, 'IN_STOCK');